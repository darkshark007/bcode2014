package ModularStrategyBot.Broadcast;

import battlecode.common.Clock;
import battlecode.common.GameActionException;
import battlecode.common.RobotController;

public class LimChan_RandD_wRedundancy_wValid extends Broadcast {
	
	/*
	 *  This is an advanced broadcast management system which implements several features:
	 *     -- Channel abstraction    : Supports consistent (but limited) channel definition, ie HQ 
	 *                                 can delegate tasks on broadcast channel 5, Soldiers can 
	 *                                 respond on channel 7, etc.  This ability is maintained.
	 *     -- Random Distribution    : broadcast channels are distributed randomly across the full 
	 *                                 broadcast spectrum (0->65,536) making the channels difficult 
	 *                                 and costly to interfere with.
	 *     -- Redundant data backup  : Data broadcasts are stored in many places (maybe hundreds) so 
	 *                                 data is still likely retrievable even despite enemy interference 
	 *                                 by checking redundant storage locations.
	 *     -- Broadcast validation   : Each broadcast is stored and retrieved with a validation code, 
	 *                                 such that interference by enemy broadcast can easily be detected 
	 *                                 and valid data can be retrieved from one of many redundant 
	 *                                 sources.  
	 * 
	 * 
	 *  This system is currently working as expected, though it has a couple problems.
	 * 
	 *  The methods are fairly optimized and light-weight, though it's a little heavy on the 
	 *  initialization.  It typically takes about 11,000-12,000 bytecodes to initialize this 
	 *  class for -each- bot, there is no way to make it static-global.  This causes a stall of at 
	 *  least one turn in every bot.
	 *  
	 *  Second, it doesnt seem as if there is much (if any) broadcast countering and/or tampering 
	 *  by competing bots.  So it may be sufficient (though risky) to just use a simple broadcast 
	 *  system, possibly with an interference detector and a signal to switch to a more secure system.
	 *  
	 *  FUTURE ADDITIONS:
	 *    -- Must make a tweak/update to the redundancy system, where if data must be retrieved from 
	 *       a redundancy source, it should be re-broadcast to a valid current location.  Experienced 
	 *       some problems with this where data broadcast early to specific channels is not maintained 
	 *       in later channels, and alot of bytecodes are spent traversing the list of redundancy 
	 *       channels. 
	 */

	static int validationCode = 24861;
	static int[] channelList = {
			0,25,50,75,100,125,150,175,200,225,250,275,300,325,350,375,400,425,450,475,500,525,550,575,600,625,650,675,700,725,750,775,800,825,850,875,900,925,950,975,1000,1025,1050,1075,1100,1125,1150,1175,1200,1225,1250,1275,1300,1325,1350,1375,1400,1425,1450,1475,1500,1525,1550,1575,1600,1625,1650,1675,1700,1725,1750,1775,1800,1825,1850,1875,1900,1925,1950,1975,2000,2025,2050,2075,2100,2125,2150,2175,2200,2225,2250,2275,2300,2325,2350,2375,2400,2425,2450,2475,2500,2525,2550,2575,2600,2625,2650,2675,2700,2725,2750,2775,2800,2825,2850,2875,2900,2925,2950,2975,3000,3025,3050,3075,3100,3125,3150,3175,3200,3225,3250,3275,3300,3325,3350,3375,3400,3425,3450,3475,3500,3525,3550,3575,3600,3625,3650,3675,3700,3725,3750,3775,3800,3825,3850,3875,3900,
			3925,3950,3975,4000,4025,4050,4075,4100,4125,4150,4175,4200,4225,4250,4275,4300,4325,4350,4375,4400,4425,4450,4475,4500,4525,4550,4575,4600,4625,4650,4675,4700,4725,4750,4775,4800,4825,4850,4875,4900,4925,4950,4975,5000,5025,5050,5075,5100,5125,5150,5175,5200,5225,5250,5275,5300,5325,5350,5375,5400,5425,5450,5475,5500,5525,5550,5575,5600,5625,5650,5675,5700,5725,5750,5775,5800,5825,5850,5875,5900,5925,5950,5975,6000,6025,6050,6075,6100,6125,6150,6175,6200,6225,6250,6275,6300,6325,6350,6375,6400,6425,6450,6475,6500,6525,6550,6575,6600,6625,6650,6675,6700,6725,6750,6775,6800,6825,6850,6875,6900,6925,6950,6975,7000,7025,7050,7075,7100,7125,7150,7175,7200,7225,7250,7275,7300,7325,7350,7375,7400,7425,7450,7475,7500,7525,7550,7575,7600,
			7625,7650,7675,7700,7725,7750,7775,7800,7825,7850,7875,7900,7925,7950,7975,8000,8025,8050,8075,8100,8125,8150,8175,8200,8225,8250,8275,8300,8325,8350,8375,8400,8425,8450,8475,8500,8525,8550,8575,8600,8625,8650,8675,8700,8725,8750,8775,8800,8825,8850,8875,8900,8925,8950,8975,9000,9025,9050,9075,9100,9125,9150,9175,9200,9225,9250,9275,9300,9325,9350,9375,9400,9425,9450,9475,9500,9525,9550,9575,9600,9625,9650,9675,9700,9725,9750,9775,9800,9825,9850,9875,9900,9925,9950,9975,10000,10025,10050,10075,10100,10125,10150,10175,10200,10225,10250,10275,10300,10325,10350,10375,10400,10425,10450,10475,10500,10525,10550,10575,10600,10625,10650,10675,10700,10725,10750,10775,10800,10825,10850,10875,10900,10925,10950,10975,11000,11025,11050,11075,
			11100,11125,11150,11175,11200,11225,11250,11275,11300,11325,11350,11375,11400,11425,11450,11475,11500,11525,11550,11575,11600,11625,11650,11675,11700,11725,11750,11775,11800,11825,11850,11875,11900,11925,11950,11975,12000,12025,12050,12075,12100,12125,12150,12175,12200,12225,12250,12275,12300,12325,12350,12375,12400,12425,12450,12475,12500,12525,12550,12575,12600,12625,12650,12675,12700,12725,12750,12775,12800,12825,12850,12875,12900,12925,12950,12975,13000,13025,13050,13075,13100,13125,13150,13175,13200,13225,13250,13275,13300,13325,13350,13375,13400,13425,13450,13475,13500,13525,13550,13575,13600,13625,13650,13675,13700,13725,13750,13775,13800,13825,13850,13875,13900,13925,13950,13975,14000,14025,14050,14075,14100,14125,14150,14175,
			14200,14225,14250,14275,14300,14325,14350,14375,14400,14425,14450,14475,14500,14525,14550,14575,14600,14625,14650,14675,14700,14725,14750,14775,14800,14825,14850,14875,14900,14925,14950,14975,15000,15025,15050,15075,15100,15125,15150,15175,15200,15225,15250,15275,15300,15325,15350,15375,15400,15425,15450,15475,15500,15525,15550,15575,15600,15625,15650,15675,15700,15725,15750,15775,15800,15825,15850,15875,15900,15925,15950,15975,16000,16025,16050,16075,16100,16125,16150,16175,16200,16225,16250,16275,16300,16325,16350,16375,16400,16425,16450,16475,16500,16525,16550,16575,16600,16625,16650,16675,16700,16725,16750,16775,16800,16825,16850,16875,16900,16925,16950,16975,17000,17025,17050,17075,17100,17125,17150,17175,17200,17225,17250,17275,
			17300,17325,17350,17375,17400,17425,17450,17475,17500,17525,17550,17575,17600,17625,17650,17675,17700,17725,17750,17775,17800,17825,17850,17875,17900,17925,17950,17975,18000,18025,18050,18075,18100,18125,18150,18175,18200,18225,18250,18275,18300,18325,18350,18375,18400,18425,18450,18475,18500,18525,18550,18575,18600,18625,18650,18675,18700,18725,18750,18775,18800,18825,18850,18875,18900,18925,18950,18975,19000,19025,19050,19075,19100,19125,19150,19175,19200,19225,19250,19275,19300,19325,19350,19375,19400,19425,19450,19475,19500,19525,19550,19575,19600,19625,19650,19675,19700,19725,19750,19775,19800,19825,19850,19875,19900,19925,19950,19975,20000,20025,20050,20075,20100,20125,20150,20175,20200,20225,20250,20275,20300,20325,20350,20375,
			20400,20425,20450,20475,20500,20525,20550,20575,20600,20625,20650,20675,20700,20725,20750,20775,20800,20825,20850,20875,20900,20925,20950,20975,21000,21025,21050,21075,21100,21125,21150,21175,21200,21225,21250,21275,21300,21325,21350,21375,21400,21425,21450,21475,21500,21525,21550,21575,21600,21625,21650,21675,21700,21725,21750,21775,21800,21825,21850,21875,21900,21925,21950,21975,22000,22025,22050,22075,22100,22125,22150,22175,22200,22225,22250,22275,22300,22325,22350,22375,22400,22425,22450,22475,22500,22525,22550,22575,22600,22625,22650,22675,22700,22725,22750,22775,22800,22825,22850,22875,22900,22925,22950,22975,23000,23025,23050,23075,23100,23125,23150,23175,23200,23225,23250,23275,23300,23325,23350,23375,23400,23425,23450,23475,
			23500,23525,23550,23575,23600,23625,23650,23675,23700,23725,23750,23775,23800,23825,23850,23875,23900,23925,23950,23975,24000,24025,24050,24075,24100,24125,24150,24175,24200,24225,24250,24275,24300,24325,24350,24375,24400,24425,24450,24475,24500,24525,24550,24575,24600,24625,24650,24675,24700,24725,24750,24775,24800,24825,24850,24875,24900,24925,24950,24975,25000,25025,25050,25075,25100,25125,25150,25175,25200,25225,25250,25275,25300,25325,25350,25375,25400,25425,25450,25475,25500,25525,25550,25575,25600,25625,25650,25675,25700,25725,25750,25775,25800,25825,25850,25875,25900,25925,25950,25975,26000,26025,26050,26075,26100,26125,26150,26175,26200,26225,26250,26275,26300,26325,26350,26375,26400,26425,26450,26475,26500,26525,26550,26575,
			26600,26625,26650,26675,26700,26725,26750,26775,26800,26825,26850,26875,26900,26925,26950,26975,27000,27025,27050,27075,27100,27125,27150,27175,27200,27225,27250,27275,27300,27325,27350,27375,27400,27425,27450,27475,27500,27525,27550,27575,27600,27625,27650,27675,27700,27725,27750,27775,27800,27825,27850,27875,27900,27925,27950,27975,28000,28025,28050,28075,28100,28125,28150,28175,28200,28225,28250,28275,28300,28325,28350,28375,28400,28425,28450,28475,28500,28525,28550,28575,28600,28625,28650,28675,28700,28725,28750,28775,28800,28825,28850,28875,28900,28925,28950,28975,29000,29025,29050,29075,29100,29125,29150,29175,29200,29225,29250,29275,29300,29325,29350,29375,29400,29425,29450,29475,29500,29525,29550,29575,29600,29625,29650,29675,
			29700,29725,29750,29775,29800,29825,29850,29875,29900,29925,29950,29975,30000,30025,30050,30075,30100,30125,30150,30175,30200,30225,30250,30275,30300,30325,30350,30375,30400,30425,30450,30475,30500,30525,30550,30575,30600,30625,30650,30675,30700,30725,30750,30775,30800,30825,30850,30875,30900,30925,30950,30975,31000,31025,31050,31075,31100,31125,31150,31175,31200,31225,31250,31275,31300,31325,31350,31375,31400,31425,31450,31475,31500,31525,31550,31575,31600,31625,31650,31675,31700,31725,31750,31775,31800,31825,31850,31875,31900,31925,31950,31975,32000,32025,32050,32075,32100,32125,32150,32175,32200,32225,32250,32275,32300,32325,32350,32375,32400,32425,32450,32475,32500,32525,32550,32575,32600,32625,32650,32675,32700,32725,32750,32775,
			32800,32825,32850,32875,32900,32925,32950,32975,33000,33025,33050,33075,33100,33125,33150,33175,33200,33225,33250,33275,33300,33325,33350,33375,33400,33425,33450,33475,33500,33525,33550,33575,33600,33625,33650,33675,33700,33725,33750,33775,33800,33825,33850,33875,33900,33925,33950,33975,34000,34025,34050,34075,34100,34125,34150,34175,34200,34225,34250,34275,34300,34325,34350,34375,34400,34425,34450,34475,34500,34525,34550,34575,34600,34625,34650,34675,34700,34725,34750,34775,34800,34825,34850,34875,34900,34925,34950,34975,35000,35025,35050,35075,35100,35125,35150,35175,35200,35225,35250,35275,35300,35325,35350,35375,35400,35425,35450,35475,35500,35525,35550,35575,35600,35625,35650,35675,35700,35725,35750,35775,35800,35825,35850,35875,
			35900,35925,35950,35975,36000,36025,36050,36075,36100,36125,36150,36175,36200,36225,36250,36275,36300,36325,36350,36375,36400,36425,36450,36475,36500,36525,36550,36575,36600,36625,36650,36675,36700,36725,36750,36775,36800,36825,36850,36875,36900,36925,36950,36975,37000,37025,37050,37075,37100,37125,37150,37175,37200,37225,37250,37275,37300,37325,37350,37375,37400,37425,37450,37475,37500,37525,37550,37575,37600,37625,37650,37675,37700,37725,37750,37775,37800,37825,37850,37875,37900,37925,37950,37975,38000,38025,38050,38075,38100,38125,38150,38175,38200,38225,38250,38275,38300,38325,38350,38375,38400,38425,38450,38475,38500,38525,38550,38575,38600,38625,38650,38675,38700,38725,38750,38775,38800,38825,38850,38875,38900,38925,38950,38975,
			39000,39025,39050,39075,39100,39125,39150,39175,39200,39225,39250,39275,39300,39325,39350,39375,39400,39425,39450,39475,39500,39525,39550,39575,39600,39625,39650,39675,39700,39725,39750,39775,39800,39825,39850,39875,39900,39925,39950,39975,40000,40025,40050,40075,40100,40125,40150,40175,40200,40225,40250,40275,40300,40325,40350,40375,40400,40425,40450,40475,40500,40525,40550,40575,40600,40625,40650,40675,40700,40725,40750,40775,40800,40825,40850,40875,40900,40925,40950,40975,41000,41025,41050,41075,41100,41125,41150,41175,41200,41225,41250,41275,41300,41325,41350,41375,41400,41425,41450,41475,41500,41525,41550,41575,41600,41625,41650,41675,41700,41725,41750,41775,41800,41825,41850,41875,41900,41925,41950,41975,42000,42025,42050,42075,
			42100,42125,42150,42175,42200,42225,42250,42275,42300,42325,42350,42375,42400,42425,42450,42475,42500,42525,42550,42575,42600,42625,42650,42675,42700,42725,42750,42775,42800,42825,42850,42875,42900,42925,42950,42975,43000,43025,43050,43075,43100,43125,43150,43175,43200,43225,43250,43275,43300,43325,43350,43375,43400,43425,43450,43475,43500,43525,43550,43575,43600,43625,43650,43675,43700,43725,43750,43775,43800,43825,43850,43875,43900,43925,43950,43975,44000,44025,44050,44075,44100,44125,44150,44175,44200,44225,44250,44275,44300,44325,44350,44375,44400,44425,44450,44475,44500,44525,44550,44575,44600,44625,44650,44675,44700,44725,44750,44775,44800,44825,44850,44875,44900,44925,44950,44975,45000,45025,45050,45075,45100,45125,45150,45175,
			45200,45225,45250,45275,45300,45325,45350,45375,45400,45425,45450,45475,45500,45525,45550,45575,45600,45625,45650,45675,45700,45725,45750,45775,45800,45825,45850,45875,45900,45925,45950,45975,46000,46025,46050,46075,46100,46125,46150,46175,46200,46225,46250,46275,46300,46325,46350,46375,46400,46425,46450,46475,46500,46525,46550,46575,46600,46625,46650,46675,46700,46725,46750,46775,46800,46825,46850,46875,46900,46925,46950,46975,47000,47025,47050,47075,47100,47125,47150,47175,47200,47225,47250,47275,47300,47325,47350,47375,47400,47425,47450,47475,47500,47525,47550,47575,47600,47625,47650,47675,47700,47725,47750,47775,47800,47825,47850,47875,47900,47925,47950,47975,48000,48025,48050,48075,48100,48125,48150,48175,48200,48225,48250,48275,
			48300,48325,48350,48375,48400,48425,48450,48475,48500,48525,48550,48575,48600,48625,48650,48675,48700,48725,48750,48775,48800,48825,48850,48875,48900,48925,48950,48975,49000,49025,49050,49075,49100,49125,49150,49175,49200,49225,49250,49275,49300,49325,49350,49375,49400,49425,49450,49475,49500,49525,49550,49575,49600,49625,49650,49675,49700,49725,49750,49775,49800,49825,49850,49875,49900,49925,49950,49975,50000,50025,50050,50075,50100,50125,50150,50175,50200,50225,50250,50275,50300,50325,50350,50375,50400,50425,50450,50475,50500,50525,50550,50575,50600,50625,50650,50675,50700,50725,50750,50775,50800,50825,50850,50875,50900,50925,50950,50975,51000,51025,51050,51075,51100,51125,51150,51175,51200,51225,51250,51275,51300,51325,51350,51375,
			51400,51425,51450,51475,51500,51525,51550,51575,51600,51625,51650,51675,51700,51725,51750,51775,51800,51825,51850,51875,51900,51925,51950,51975,52000,52025,52050,52075,52100,52125,52150,52175,52200,52225,52250,52275,52300,52325,52350,52375,52400,52425,52450,52475,52500,52525,52550,52575,52600,52625,52650,52675,52700,52725,52750,52775,52800,52825,52850,52875,52900,52925,52950,52975,53000,53025,53050,53075,53100,53125,53150,53175,53200,53225,53250,53275,53300,53325,53350,53375,53400,53425,53450,53475,53500,53525,53550,53575,53600,53625,53650,53675,53700,53725,53750,53775,53800,53825,53850,53875,53900,53925,53950,53975,54000,54025,54050,54075,54100,54125,54150,54175,54200,54225,54250,54275,54300,54325,54350,54375,54400,54425,54450,54475,
			54500,54525,54550,54575,54600,54625,54650,54675,54700,54725,54750,54775,54800,54825,54850,54875,54900,54925,54950,54975,55000,55025,55050,55075,55100,55125,55150,55175,55200,55225,55250,55275,55300,55325,55350,55375,55400,55425,55450,55475,55500,55525,55550,55575,55600,55625,55650,55675,55700,55725,55750,55775,55800,55825,55850,55875,55900,55925,55950,55975,56000,56025,56050,56075,56100,56125,56150,56175,56200,56225,56250,56275,56300,56325,56350,56375,56400,56425,56450,56475,56500,56525,56550,56575,56600,56625,56650,56675,56700,56725,56750,56775,56800,56825,56850,56875,56900,56925,56950,56975,57000,57025,57050,57075,57100,57125,57150,57175,57200,57225,57250,57275,57300,57325,57350,57375,57400,57425,57450,57475,57500,57525,57550,57575,
			57600,57625,57650,57675,57700,57725,57750,57775,57800,57825,57850,57875,57900,57925,57950,57975,58000,58025,58050,58075,58100,58125,58150,58175,58200,58225,58250,58275,58300,58325,58350,58375,58400,58425,58450,58475,58500,58525,58550,58575,58600,58625,58650,58675,58700,58725,58750,58775,58800,58825,58850,58875,58900,58925,58950,58975,59000,59025,59050,59075,59100,59125,59150,59175,59200,59225,59250,59275,59300,59325,59350,59375,59400,59425,59450,59475,59500,59525,59550,59575,59600,59625,59650,59675,59700,59725,59750,59775,59800,59825,59850,59875,59900,59925,59950,59975,60000,60025,60050,60075,60100,60125,60150,60175,60200,60225,60250,60275,60300,60325,60350,60375,60400,60425,60450,60475,60500,60525,60550,60575,60600,60625,60650,60675,
			60700,60725,60750,60775,60800,60825,60850,60875,60900,60925,60950,60975,61000,61025,61050,61075,61100,61125,61150,61175,61200,61225,61250,61275,61300,61325,61350,61375,61400,61425,61450,61475,61500,61525,61550,61575,61600,61625,61650,61675,61700,61725,61750,61775,61800,61825,61850,61875,61900,61925,61950,61975,62000,62025,62050,62075,62100,62125,62150,62175,62200,62225,62250,62275,62300,62325,62350,62375,62400,62425,62450,62475,62500,62525,62550,62575
	};
	
	public LimChan_RandD_wRedundancy_wValid(RobotController in) { super(in); }
	
	public void broadcast(int index, int value) throws GameActionException {
		// Get the channels
		int rnd = Clock.getRoundNum();

		// Encode and broadcast the transmissions
		rc.broadcast((channelList[rnd+0])+index, ((rnd+0)*validationCode)+value); 
		rc.broadcast((channelList[rnd+1])+index, ((rnd+1)*validationCode)+value); 
		rc.broadcast((channelList[rnd+2])+index, ((rnd+2)*validationCode)+value); 
	}
	
	public int readBroadcast(int index) throws GameActionException {
		int rnd,chan,chanRead,value;
		
		// First, check the current expected channel
		// Assume the broadcast is valid, pull all data from it and validate it
		rnd = Clock.getRoundNum();
		chan = (channelList[rnd])+index;
		chanRead = rc.readBroadcast(chan);
		value = chanRead % validationCode;
		if ( (chanRead-value)/validationCode == rnd ) {
			// The broadcast is valid, return the value
			return value;
		}

		
		// If the last channel is invalid, check the first redundancy, which is next rounds channel   
		// Assume the broadcast is valid, pull all data from it and validate it
		rnd += 1;
		chan = (channelList[rnd])+index;
		chanRead = rc.readBroadcast(chan);
		value = chanRead % validationCode;
		if ( (chanRead-value)/validationCode == rnd ) {
			// The broadcast is valid, return the value
			return value;
		}

		
		// If the last channel is invalid, check the second redundancy, which is next next rounds channel   
		// Assume the broadcast is valid, pull all data from it and validate it
		rnd += 1;
		chan = (channelList[rnd])+index;
		chanRead = rc.readBroadcast(chan);
		value = chanRead % validationCode;
		if ( (chanRead-value)/validationCode == rnd ) {
			// The broadcast is valid, return the value
			return value;
		}

		
		
		// Future additions, further redundancy may be possible by checking all previous channels for the last known valid result
		/* Extra Redundancy */
		rnd -= 2;
		while ( rnd > 0 ) {
			rnd -= 1;
			chan = (channelList[rnd])+index;
			chanRead = rc.readBroadcast(chan);
			value = chanRead % validationCode;
			if ( (chanRead-value)/validationCode == rnd ) {
				// The broadcast is valid, return the value
				return value;
			}
		}
		/* */
		
		return -1;
	}

}
